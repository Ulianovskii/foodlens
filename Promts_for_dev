# –ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π —Å–µ—Å—Å–∏–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

## –ü—Ä–æ–µ–∫—Ç: FoodLens - Telegram –±–æ—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø–∏—Ç–∞–Ω–∏—è

**–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:** https://github.com/Ulianovskii/foodlens  
**–õ–æ–∫–∞–ª—å–Ω–∞—è –ø–∞–ø–∫–∞:** `/Users/andrew/Dev/foodlens`  
**–ö–æ–º–ø—å—é—Ç–µ—Ä:** MacBook M1 Pro



## üìã –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞

### ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ:
- **–ú–æ–¥—É–ª—å 1-2**: –ë–∞–∑–æ–≤—ã–π –∫–∞—Ä–∫–∞—Å –±–æ—Ç–∞ (aiogram 3.x, –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è, Makefile)
- **–ú–æ–¥—É–ª—å 3**: –°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (US1) - **–ü–û–õ–ù–û–°–¢–¨–Æ –ì–û–¢–û–í–û**
  - GPT-4 Vision API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
  - –°–∏—Å—Ç–µ–º–∞ —Å–µ—Å—Å–∏–π —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º (1 —Ñ–æ—Ç–æ + 5 —É—Ç–æ—á–Ω–µ–Ω–∏–π)
  - Reply-–∫–Ω–æ–ø–∫–∏ "üìä –ö–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç—å"/"üë®‚Äçüç≥ –†–µ—Ü–µ–ø—Ç"
  - –ó–∞—â–∏—Ç–∞ –æ—Ç —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö —Ç–µ–º, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –≤–µ—Å–∞

### üîÑ –¢–µ–∫—É—â–∏–π –º–æ–¥—É–ª—å: –ú–æ–¥—É–ª—å 4 - –°–∏—Å—Ç–µ–º–∞ –ª–∏–º–∏—Ç–æ–≤ –∏ –ø—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
**–¶–µ–ª—å:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É —Ç–∞—Ä–∏—Ñ–æ–≤ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –∑–∞–ø—Ä–æ—Å–æ–≤

## üéØ –ó–∞–¥–∞—á–∏ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π —Å–µ—Å—Å–∏–∏

### –ú–æ–¥—É–ª—å 4: –°–∏—Å—Ç–µ–º–∞ –ª–∏–º–∏—Ç–æ–≤ –∏ –ø—Ä–æ—Ñ–∏–ª–∏
1. **–†–∞—Å—à–∏—Ä–∏—Ç—å –º–æ–¥–µ–ª—å User –≤ –ë–î:**
   - `subscription_type` (free/premium_week/premium_month)
   - `subscription_until` (timestamp)
   - `daily_photos_used`, `total_photos_analyzed`
   - `last_reset_date` –¥–ª—è —Å–±—Ä–æ—Å–∞ —Å—á–µ—Ç—á–∏–∫–æ–≤

2. **Middleware –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ –∑–∞–ø—Ä–æ—Å–æ–≤:**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Ñ–æ—Ç–æ
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–¥—Å—á–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ
   - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞

3. **–°–∏—Å—Ç–µ–º–∞ —Ç–∞—Ä–∏—Ñ–æ–≤:**
   - –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π: 3 —Ñ–æ—Ç–æ/–¥–µ–Ω—å + —Ä–µ–∫–ª–∞–º–∞
   - –ü—Ä–µ–º–∏—É–º: 10 —Ñ–æ—Ç–æ/–¥–µ–Ω—å –±–µ–∑ —Ä–µ–∫–ª–∞–º—ã
   - –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π —Å–±—Ä–æ—Å —Å—á–µ—Ç—á–∏–∫–æ–≤ –≤ 00:00

4. **–û–±–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—Å—Ç—ã –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏:**
   - –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–¥ —Ç–∞—Ä–∏—Ñ
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ª–∏–º–∏—Ç–∞—Ö
   - –†–µ–∫–ª–∞–º–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (–ù–ï –ú–ï–ù–Ø–¢–¨)
```
app/
‚îú‚îÄ‚îÄ handlers/          # –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
‚îú‚îÄ‚îÄ locales/ru/        # –°–∏—Å—Ç–µ–º–∞ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ services/          # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ models/           # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îî‚îÄ‚îÄ middlewares/      # Middleware –¥–ª—è –ª–∏–º–∏—Ç–æ–≤
```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** `.env` —Ñ–∞–π–ª  
**–ó–∞–ø—É—Å–∫:** `make run`, `make install`  
**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** PostgreSQL

## üìù –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –î–ª—è –ú–æ–¥—É–ª—è 4:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É `app/`
- –í—Å–µ —Ç–µ–∫—Å—Ç—ã –≤ `app/locales/ru/texts.py`
- –ù–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤ `app/handlers/`
- –ú–æ–¥–µ–ª–∏ –≤ `app/models/`
- Middleware –≤ `app/middlewares/`

### –ö–ª—é—á–µ–≤—ã–µ –∞—Å–ø–µ–∫—Ç—ã:
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** –ë–î –∏ API
- **Graceful degradation** –ø—Ä–∏ –∏—Å—á–µ—Ä–ø–∞–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã** –∫–Ω–æ–ø–æ–∫ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–π

## üîÑ Workflow –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏):
1. **/start** ‚Üí –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ª–∏–º–∏—Ç–∞—Ö
2. **–û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ç–æ** ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ ‚Üí –∞–Ω–∞–ª–∏–∑ –∏–ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
3. **–ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞** ‚Üí –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–µ–º–∏—É–º-—Ç–∞—Ä–∏—Ñ–∞
4. **–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π —Å–±—Ä–æ—Å** ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤

# –ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π —Å–µ—Å—Å–∏–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ FoodLens

## üéØ –¢–ï–ö–£–©–ò–ô –°–¢–ê–¢–£–° –ü–†–û–ï–ö–¢–ê

### ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û:
- **–ú–æ–¥—É–ª—å 1-3**: –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∏–π –±–æ—Ç —Å –∞–Ω–∞–ª–∏–∑–æ–º —Ñ–æ—Ç–æ —á–µ—Ä–µ–∑ GPT-4 Vision
- **–ë–∞–∑–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –ª–∏–º–∏—Ç–æ–≤**: Middleware –ø—Ä–æ–≤–µ—Ä—è–µ—Ç 3 —Ñ–æ—Ç–æ/–¥–µ–Ω—å –¥–ª—è –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–ê–¥–º–∏–Ω-–∫–æ–º–∞–Ω–¥—ã**: `/generate_promo`, `/reset_limits`, `/user_info`, `/promo_list`

### üîÑ –ß–¢–û –°–ï–ô–ß–ê–° –†–ê–ë–û–¢–ê–ï–¢:
- ‚úÖ –ê–Ω–∞–ª–∏–∑ —Ñ–æ—Ç–æ –µ–¥—ã —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º (1 —Ñ–æ—Ç–æ + 5 —É—Ç–æ—á–Ω–µ–Ω–∏–π)
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –ª–∏–º–∏—Ç–æ–≤ (3 —Ñ–æ—Ç–æ/–¥–µ–Ω—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ, 10 —Ñ–æ—Ç–æ –ø—Ä–µ–º–∏—É–º)
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –ø—Ä–æ–º–æ–∫–æ–¥–∞–º–∏
- ‚úÖ –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ (—Ç—Ä–µ–±—É—é—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è):
1. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–æ–≤** –≤ bot.py - –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É –∑–∞–ø—É—Å–∫–∞
2. **Middleware –ø–∞–¥–∞–µ—Ç** –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –ª–∏–º–∏—Ç–æ–≤

## üéØ –ó–ê–î–ê–ß–ò –î–õ–Ø –°–õ–ï–î–£–Æ–©–ï–ô –°–ï–°–°–ò–ò

### 1. üêõ –°–†–û–ß–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –û–®–ò–ë–û–ö:
- –ü–æ—á–∏–Ω–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–æ–≤ –≤ `app/bot.py`
- –ò—Å–ø—Ä–∞–≤–∏—Ç—å middleware –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–∏–º–∏—Ç–æ–≤

### 2. üíé –°–ò–°–¢–ï–ú–ê –ü–†–û–§–ò–õ–Ø –ò –ü–û–î–ü–ò–°–ö–ò:
- **–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ª–∏–º–∏—Ç–∞—Ö
- **–ú–µ–Ω—é –ø–æ–¥–ø–∏—Å–∫–∏** —Å –∫–Ω–æ–ø–∫–∞–º–∏:
  - ‚≠êÔ∏è –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –Ω–µ–¥–µ–ª—é (–∑–≤–µ–∑–¥—ã)
  - ‚≠êÔ∏è –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –º–µ—Å—è—Ü (–∑–≤–µ–∑–¥—ã) 
  - üéÅ –í–≤–µ—Å—Ç–∏ –ø—Ä–æ–º–æ–∫–æ–¥
- **–ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤** –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–µ–º–∏—É–º-–¥–æ—Å—Ç—É–ø–∞

### 3. üîß –ò–ù–°–¢–†–£–ú–ï–ù–¢–´ –î–õ–Ø –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø:
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–∫–æ–º–∞–Ω–¥—ã
- –°–±—Ä–æ—Å –ª–∏–º–∏—Ç–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º/–ø—Ä–µ–º–∏—É–º —Ä–µ–∂–∏–º–∞–º–∏

## üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ê (–ù–ï –ú–ï–ù–Ø–¢–¨)
```
app/
‚îú‚îÄ‚îÄ handlers/          # basic_commands.py, photo_handler.py, admin_handlers.py
‚îú‚îÄ‚îÄ locales/ru/        # texts.py —Å —Ä—É—Å—Å–∫–æ–π –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–µ–π  
‚îú‚îÄ‚îÄ services/          # UserService, LimitService, PromoService
‚îú‚îÄ‚îÄ models/           # User, PromoCode
‚îú‚îÄ‚îÄ middlewares/      # limit_middleware.py
‚îî‚îÄ‚îÄ database.py       # PostgreSQL + asyncpg
```

## üöÄ –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ô –ö–û–ù–¢–ï–ö–°–¢

**–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:** https://github.com/Ulianovskii/foodlens  
**–õ–æ–∫–∞–ª—å–Ω–∞—è –ø–∞–ø–∫–∞:** `/Users/andrew/Dev/foodlens`  
**–ö–æ–º–ø—å—é—Ç–µ—Ä:** MacBook M1 Pro  
**–ó–∞–ø—É—Å–∫:** `make run`, `make install`  
**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** PostgreSQL –≤ Docker

## üìã USER STORY –î–õ–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–ò:

1. **–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** (/profile):
   - –Ø–∑—ã–∫: —Ä—É—Å—Å–∫–∏–π
   - –ü–æ–¥–ø–∏—Å–∫–∞: –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è/–ø—Ä–µ–º–∏—É–º
   - –ó–∞–ø—Ä–æ—Å–æ–≤ –æ—Å—Ç–∞–ª–æ—Å—å: X –∏–∑ Y
   - –¢–µ–∫—Å—Ç –æ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞—Ö –ø—Ä–µ–º–∏—É–º–∞

2. **–ú–µ–Ω—é –ø–æ–¥–ø–∏—Å–∫–∏**:
   - "–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –µ–¥—É"
   - "–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è ‚≠êÔ∏è" ‚Üí –ø–æ–¥–º–µ–Ω—é:
     - "–ù–µ–¥–µ–ª—è (X –∑–≤–µ–∑–¥)"
     - "–ú–µ—Å—è—Ü (Y –∑–≤–µ–∑–¥)" 
     - "–í–≤–µ—Å—Ç–∏ –ø—Ä–æ–º–æ–∫–æ–¥"

3. **–ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞**:
   - –í–≤–æ–¥ –∫–æ–¥–∞ ‚Üí –∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —É—Å–ø–µ—à–Ω–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏

## üîß –ì–û–¢–û–í–´ –ù–ê–ß–ê–¢–¨?

**–ü–µ—Ä–≤—ã–µ —à–∞–≥–∏:**
1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–æ–≤ –≤ bot.py
2. –ü–æ—á–∏–Ω–∏—Ç—å middleware –¥–ª—è –ª–∏–º–∏—Ç–æ–≤
3. –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É /profile —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ

**–ù–∞—á–Ω–µ–º —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫?** üöÄ