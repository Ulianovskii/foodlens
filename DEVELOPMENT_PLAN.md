# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è FoodLens

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
1. [–û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ](#–æ–±—â–µ–µ-–æ–ø–∏—Å–∞–Ω–∏–µ)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
3. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
4. [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–∏-–∑–∞–ø—É—Å–∫)
5. [–†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö](#—Ä–∞–±–æ—Ç–∞-—Å-–±–∞–∑–æ–π-–¥–∞–Ω–Ω—ã—Ö)
6. [–°–∏—Å—Ç–µ–º–∞ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏](#—Å–∏—Å—Ç–µ–º–∞-–ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏)
7. [–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π](#–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏-—Å–æ–æ–±—â–µ–Ω–∏–π)
8. [–°–µ—Ä–≤–∏—Å—ã –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞](#—Å–µ—Ä–≤–∏—Å—ã-–∏-–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)
9. [–†–∞–±–æ—Ç–∞ —Å GPT API](#—Ä–∞–±–æ—Ç–∞-—Å-gpt-api)
10. [–°–∏—Å—Ç–µ–º–∞ –ª–∏–º–∏—Ç–æ–≤ –∏ –ø–æ–¥–ø–∏—Å–æ–∫](#—Å–∏—Å—Ç–µ–º–∞-–ª–∏–º–∏—Ç–æ–≤-–∏-–ø–æ–¥–ø–∏—Å–æ–∫)
11. [–ü—Ä–æ–º–æ–∫–æ–¥—ã –∏ –æ–ø–ª–∞—Ç–∞](#–ø—Ä–æ–º–æ–∫–æ–¥—ã-–∏-–æ–ø–ª–∞—Ç–∞)
12. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
13. [–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π](#—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞-–Ω–æ–≤—ã—Ö-—Ñ—É–Ω–∫—Ü–∏–π)

## –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

**FoodLens** - Telegram –±–æ—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –µ–¥—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º AI. –ë–æ—Ç –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç—å, –ë–ñ–£ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ä–µ—Ü–µ–ø—Ç—ã –±–ª—é–¥.

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫:**
- Python 3.11+
- Aiogram 3.x (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è Telegram)
- PostgreSQL (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)
- OpenAI GPT-4 Vision API (–∞–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
- Docker (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:** ‚úÖ **–ú–æ–¥—É–ª—å 4 - –°–∏—Å—Ç–µ–º–∞ –ª–∏–º–∏—Ç–æ–≤ –∏ –ø—Ä–æ—Ñ–∏–ª–µ–π - –ó–ê–í–ï–†–®–ï–ù**

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –ü—Ä–∏–Ω—Ü–∏–ø—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:
- **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å** - –∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –º–æ–¥—É–ª–µ
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å** - –≤–µ—Å—å –∫–æ–¥ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–æ—Å—Ç—å** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ .env —Ñ–∞–π–ª
- **–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è** - –≤—Å–µ —Ç–µ–∫—Å—Ç—ã –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
```
app/
‚îú‚îÄ‚îÄ handlers/     # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –∫–æ–º–∞–Ω–¥
‚îú‚îÄ‚îÄ services/     # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏ –≤–Ω–µ—à–Ω–∏–µ API
‚îú‚îÄ‚îÄ models/       # –ú–æ–¥–µ–ª–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ locales/      # –°–∏—Å—Ç–µ–º–∞ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ keyboards/    # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏ –∫–Ω–æ–ø–∫–∏
‚îú‚îÄ‚îÄ core/         # –Ø–¥—Ä–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ middlewares/  # Middleware –¥–ª—è –ª–∏–º–∏—Ç–æ–≤
‚îî‚îÄ‚îÄ prompts/      # –ü—Ä–æ–º—Ç—ã –¥–ª—è GPT
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã –∏ –ø–∞–ø–∫–∏:

```
foodlens/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ bot.py                 # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ handlers/              # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py        # –ò–º–ø–æ—Ä—Ç –≤—Å–µ—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ basic_commands.py  # –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã (/start, /help, /limits)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ photo_handler.py   # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ admin_commands.py  # –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ gpt_analyzer.py    # –°–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç—ã —Å OpenAI API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user_service.py    # –°–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ promo_service.py   # –°–µ—Ä–≤–∏—Å –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.py           # –ú–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ä–∞—Å—à–∏—Ä–µ–Ω–∞)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ food_log.py       # –ú–æ–¥–µ–ª—å –∑–∞–ø–∏—Å–∏ –¥–Ω–µ–≤–Ω–∏–∫–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ promo.py          # –ú–æ–¥–µ–ª—å –ø—Ä–æ–º–æ–∫–æ–¥–∞ (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
‚îÇ   ‚îú‚îÄ‚îÄ locales/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ru/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ texts.py      # –í—Å–µ —Ç–µ–∫—Å—Ç—ã –Ω–∞ —Ä—É—Å—Å–∫–æ–º
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ base.py           # –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ keyboards/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main_menu.py      # –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ analysis_menu.py  # –ú–µ–Ω—é –∞–Ω–∞–ª–∏–∑–∞
‚îÇ   ‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ i18n.py           # –°–∏—Å—Ç–µ–º–∞ –∏–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ middlewares/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ limit_middleware.py # Middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–∏–º–∏—Ç–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ prompts/
‚îÇ       ‚îî‚îÄ‚îÄ food_analysis.py  # –ü—Ä–æ–º—Ç—ã –¥–ª—è GPT
‚îú‚îÄ‚îÄ tests/                    # –¢–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ requirements.txt          # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ makefile                 # –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
‚îî‚îÄ‚îÄ .env                     # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
```bash
git clone https://github.com/Ulianovskii/foodlens.git
cd foodlens
python -m venv venv
source venv/bin/activate  # Linux/Mac
# –∏–ª–∏ venv\Scripts\activate  # Windows
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
make install
# –∏–ª–∏
pip install -r requirements.txt
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```bash
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å .env —Ñ–∞–π–ª:
# BOT_TOKEN=your_telegram_bot_token
# OPENAI_API_KEY=your_openai_api_key
# DATABASE_URL=postgresql://user:pass@localhost/foodlens
```

### 4. –ó–∞–ø—É—Å–∫ —Å Docker
```bash
make docker-up    # –ó–∞–ø—É—Å–∫ PostgreSQL –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
make run          # –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
```

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã Makefile:
```bash
make install      # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
make run          # –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
make restart      # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
make docker-up    # –ó–∞–ø—É—Å–∫ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
make test         # –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
```

## –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

### –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö:

#### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (User) - –†–ê–°–®–ò–†–ï–ù–ê:
```python
@dataclass
class User:
    user_id: int
    created_at: datetime
    language: str = "ru"
    subscription_type: str = "free"  # free/premium_week/premium_month
    subscription_until: Optional[datetime] = None
    daily_photos_used: int = 0
    daily_texts_used: int = 0
    last_reset_date: Optional[date] = None
    custom_photo_limit: Optional[int] = None
    custom_text_limit: Optional[int] = None
    
    def has_photo_quota(self) -> bool:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ñ–æ—Ç–æ-–∑–∞–ø—Ä–æ—Å–æ–≤"""
        daily_limit = self._get_daily_photo_limit()
        return self.daily_photos_used < daily_limit
```

#### –ü—Ä–æ–º–æ–∫–æ–¥ (PromoCode) - –í –†–ê–ó–†–ê–ë–û–¢–ö–ï:
```python
@dataclass
class PromoCode:
    code: str
    subscription_type: str  # premium_week/premium_month
    days_valid: int
    used_count: int = 0
    max_uses: Optional[int] = None
    is_active: bool = True
    created_at: datetime = field(default_factory=datetime.now)
```

### –†–∞–±–æ—Ç–∞ —Å –ë–î:
```python
from app.models.user import User
from app.services.user_service import UserService

# –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
user_service = UserService(database)
user = await user_service.get_or_create_user(user_id)
if user.has_photo_quota():
    await user_service.increment_photo_counter(user_id)
```

## –°–∏—Å—Ç–µ–º–∞ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ–∫—Å—Ç–æ–≤:
–í—Å–µ —Ç–µ–∫—Å—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `app/locales/ru/texts.py`:

```python
class RussianLocalization(BaseLocalization):
    def __init__(self):
        self._texts = {
            'start_welcome': "üçï –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ FoodLens!...",
            'limits_info': "üìä –í–∞—à–∏ –ª–∏–º–∏—Ç—ã:\n–ê–Ω–∞–ª–∏–∑–æ–≤ —Ñ–æ—Ç–æ: {photos_used}/{photos_limit}",
            'premium_active': "üíé –ü—Ä–µ–º–∏—É–º-–∞–∫—Ç–∏–≤–µ–Ω",
            'free_tier': "üÜì –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç–∞—Ä–∏—Ñ",
            # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã
        }
        self._buttons = {
            'analyze_food': "üì∏ –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –µ–¥—É",
            'profile': "üë§ –ü—Ä–æ—Ñ–∏–ª—å",
            # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
        }
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ:
```python
from app.core.i18n import get_localization

i18n = get_localization()
text = i18n.get_text('start_welcome')
button_text = i18n.get_button_text('analyze_food')
```

## –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

### –û—Å–Ω–æ–≤–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:

#### –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã (`basic_commands.py`):
- `/start` - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ª–∏–º–∏—Ç–∞—Ö
- `/help` - –ø–æ–º–æ—â—å
- `/limits` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–∏—Ö –ª–∏–º–∏—Ç–∞—Ö
- `/cancel` - –æ—Ç–º–µ–Ω–∞ —Ç–µ–∫—É—â–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è
- `/menu` - –≤–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

#### –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ (`photo_handler.py`):
- –ü—Ä–∏–µ–º —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ª–∏–º–∏—Ç–æ–≤
- –ü–æ–∫–∞–∑ –º–µ–Ω—é –∞–Ω–∞–ª–∏–∑–∞
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫ "–ö–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç—å" –∏ "–†–µ—Ü–µ–ø—Ç"

#### –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (`admin_commands.py`) - –í –†–ê–ó–†–ê–ë–û–¢–ö–ï:
- `/admin_create_promo` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
- `/admin_reset_limits` - —Å–±—Ä–æ—Å –ª–∏–º–∏—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### Middleware –¥–ª—è –ª–∏–º–∏—Ç–æ–≤:
```python
class LimitMiddleware(BaseMiddleware):
    async def __call__(self, handler, event, data):
        user = data["user"]
        if await self.is_limit_exceeded(user):
            await event.answer("–õ–∏–º–∏—Ç –∏—Å—á–µ—Ä–ø–∞–Ω")
            return
        return await handler(event, data)
```

## –°–µ—Ä–≤–∏—Å—ã –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

### UserService (`services/user_service.py`):
```python
class UserService:
    async def get_or_create_user(self, user_id: int) -> User
    async def increment_photo_counter(self, user_id: int) -> bool
    async def reset_daily_counters_if_needed(self, user: User)
    async def activate_subscription(self, user_id: int, subscription_type: str, days: int)
```

### GPT –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä (`services/gpt_analyzer.py`):
```python
class GPTAnalyzer:
    async def analyze_food_image(self, user_id: int, image_file, analysis_type: str)
```

### PromoService (`services/promo_service.py`) - –í –†–ê–ó–†–ê–ë–û–¢–ö–ï:
```python
class PromoService:
    async def create_promo_code(self, code: str, subscription_type: str, days_valid: int)
    async def use_promo_code(self, code: str, user_id: int) -> bool
```

## –†–∞–±–æ—Ç–∞ —Å GPT API

### –ü—Ä–æ–º—Ç—ã (`prompts/food_analysis.py`):
- `SYSTEM_PROMPT_NUTRITION` - –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç–∏
- `SYSTEM_PROMPT_RECIPE` - –¥–ª—è —Ä–µ—Ü–µ–ø—Ç–æ–≤
- `get_system_prompt()` - –≤—ã–±–æ—Ä –ø—Ä–æ–º—Ç–∞ –ø–æ —Ç–∏–ø—É –∞–Ω–∞–ª–∏–∑–∞

### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ GPT:
```
üî• 500 –ö–∫–∞–ª
üçó –ë: 30–≥  ü•ë –ñ: 20–≥  üçö –£: 45–≥

üçΩÔ∏è –ù–∞–∑–≤–∞–Ω–∏–µ –±–ª—é–¥–∞
- üî• –ö–∞–ª–æ—Ä–∏–∏: 500 –∫–∫–∞–ª
- ‚öñÔ∏è –í–µ—Å: 300–≥
- üçó –ë–µ–ª–∫–∏: 30–≥
- ü•ë –ñ–∏—Ä—ã: 20–≥  
- üçö –£–≥–ª–µ–≤–æ–¥—ã: 45–≥
```

## –°–∏—Å—Ç–µ–º–∞ –ª–∏–º–∏—Ç–æ–≤ –∏ –ø–æ–¥–ø–∏—Å–æ–∫

### ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û:

#### –¢–∞—Ä–∏—Ñ–Ω—ã–µ –ø–ª–∞–Ω—ã:
- **–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π**: 3 —Ñ–æ—Ç–æ/–¥–µ–Ω—å
- **–ü—Ä–µ–º–∏—É–º (–Ω–µ–¥–µ–ª—è)**: 10 —Ñ–æ—Ç–æ/–¥–µ–Ω—å
- **–ü—Ä–µ–º–∏—É–º (–º–µ—Å—è—Ü)**: 10 —Ñ–æ—Ç–æ/–¥–µ–Ω—å

#### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–¥—Å—á–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ
- –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π —Å–±—Ä–æ—Å —Å—á–µ—Ç—á–∏–∫–æ–≤ –≤ 00:00
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Ñ–æ—Ç–æ
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ª–∏–º–∏—Ç–∞—Ö –≤ –∫–æ–º–∞–Ω–¥–µ `/start`

#### –ú–æ–¥–µ–ª—å User —Ä–∞—Å—à–∏—Ä–µ–Ω–∞ –ø–æ–ª—è–º–∏:
- `subscription_type` - —Ç–∏–ø –ø–æ–¥–ø–∏—Å–∫–∏
- `subscription_until` - –¥–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏
- `daily_photos_used` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ–æ—Ç–æ –∑–∞ –¥–µ–Ω—å
- `last_reset_date` - –¥–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–±—Ä–æ—Å–∞ —Å—á–µ—Ç—á–∏–∫–æ–≤

## –ü—Ä–æ–º–æ–∫–æ–¥—ã –∏ –æ–ø–ª–∞—Ç–∞

### üöß –í –†–ê–ó–†–ê–ë–û–¢–ö–ï:

#### –ü–ª–∞–Ω–∏—Ä—É–µ–º–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
- –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ –¥–ª—è –ø–ª–∞—Ç–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏
- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞–º–∏
- –°–±—Ä–æ—Å –ª–∏–º–∏—Ç–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram Stars –¥–ª—è –æ–ø–ª–∞—Ç—ã

#### –ú–æ–¥–µ–ª—å PromoCode:
- –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–æ–¥—ã –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π
- –¢–∏–ø –ø–æ–¥–ø–∏—Å–∫–∏ (–Ω–µ–¥–µ–ª—è/–º–µ—Å—è—Ü)
- –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è

#### –ü–ª–∞—Ç–µ–∂–∏ —á–µ—Ä–µ–∑ Telegram Stars:
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ @BotFather
- –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –≤—ã–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ Fragment
- –û—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ç–∞—Ä–∏—Ñ–æ–≤

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:
```bash
make test
# –∏–ª–∏
pytest tests/
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤:
```
tests/
‚îú‚îÄ‚îÄ test_bot_handlers.py    # –¢–µ—Å—Ç—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
‚îú‚îÄ‚îÄ test_gpt_analyzer.py    # –¢–µ—Å—Ç—ã GPT —Å–µ—Ä–≤–∏—Å–∞
‚îú‚îÄ‚îÄ test_user_service.py    # –¢–µ—Å—Ç—ã —Å–∏—Å—Ç–µ–º—ã –ª–∏–º–∏—Ç–æ–≤
‚îú‚îÄ‚îÄ conftest.py            # –§–∏–∫—Å—Ç—É—Ä—ã
‚îî‚îÄ‚îÄ quick_test.py          # –ë—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã
```

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

### –¢–µ–∫—É—â–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã:
1. **‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ**: –°–∏—Å—Ç–µ–º–∞ –ª–∏–º–∏—Ç–æ–≤ –∏ –ø–æ–¥–ø–∏—Å–æ–∫ (–ú–æ–¥—É–ª—å 4)
2. **üöß –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ**: –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
3. **üìã –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram Stars
4. **üìã –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è**: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
1. –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏
3. –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –¥–∞–Ω–Ω—ã—Ö
4. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
5. –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
6. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ª–∞–¥–∫–∞

## –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û:
- **–ú–æ–¥—É–ª—å 1-2**: –ë–∞–∑–æ–≤—ã–π –∫–∞—Ä–∫–∞—Å –±–æ—Ç–∞
- **–ú–æ–¥—É–ª—å 3**: –°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- **–ú–æ–¥—É–ª—å 4**: –°–∏—Å—Ç–µ–º–∞ –ª–∏–º–∏—Ç–æ–≤ –∏ –ø—Ä–æ—Ñ–∏–ª–µ–π

### üöß –í –†–ê–ó–†–ê–ë–û–¢–ö–ï:
- –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –æ–ø–ª–∞—Ç—ã

### üìã –ü–õ–ê–ù–ò–†–£–ï–¢–°–Ø:
- –î–Ω–µ–≤–Ω–∏–∫ –ø–∏—Ç–∞–Ω–∏—è
- –ò—Å—Ç–æ—Ä–∏—è –∞–Ω–∞–ª–∏–∑–æ–≤
- –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

---

**–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è:** v0.4.0 (–°–∏—Å—Ç–µ–º–∞ –ª–∏–º–∏—Ç–æ–≤)
**–°–ª–µ–¥—É—é—â–∏–π —Ä–µ–ª–∏–∑:** v0.5.0 (–ü—Ä–æ–º–æ–∫–æ–¥—ã –∏ –æ–ø–ª–∞—Ç–∞)

–ì–æ—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –ª—é–±—ã–µ –≤–æ–ø—Ä–æ—Å—ã –ø–æ –∫–æ–¥—É! üöÄ